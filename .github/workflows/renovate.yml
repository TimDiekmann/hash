name: Update dependencies
on:
  workflow_dispatch:
    inputs:
      logLevel:
        description: "Override default log level"
        required: false
        default: "info"
        type: choice
        options:
          - "debug"
          - "info"
          - "warn"
          - "error"
      overrideSchedule:
        description: "Override all schedules"
        required: false
        default: false
        type: boolean
#  schedule:
    # Run every 30 minutes
#    - cron: "0/30 * * * *"
concurrency:
  cancel-in-progress: true
  group: renovate
jobs:
  renovate:
    runs-on: ubuntu-latest
    steps:
      - name: Get token
        id: get_token
        uses: tibdex/github-app-token@021a2405c7f990db57f5eae5397423dcc554159c # v1.7.0
        with:
          app_id: ${{ secrets.APP_ID }}
          private_key: ${{ secrets.PRIVATE_KEY }}

      - name: Checkout
        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7
        with:
          token: ${{ steps.get_token.outputs.token }}

      - name: Run renovate
        uses: renovatebot/github-action@v40.2.7
        with:
          token: ${{ steps.get_token.outputs.token }}
          configurationFile: .github/renovate.json
        env:
          LOG_LEVEL: ${{ inputs.logLevel || 'info' }}
          RENOVATE_FORCE: ${{ github.event.inputs.overrideSchedule == 'true' && '{"schedule":null}' || '' }}
          RENOVATE_USERNAME: Renovate[bot]
          RENOVATE_GIT_AUTHOR: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>
          RENOVATE_PLATFORM_COMMIT: "true"
          RENOVATE_REPOSITORIES: ${{ github.repository }}
